# How to Recreate This Repository and Add a New Genome: Step-by-Step Guide

This guide explains how to fully regenerate the data and documentation for this repository from scratch, ensuring reproducibility and transparency.

## Prerequisites

- R (version >= 4.0 recommended)
- R packages: `devtools`, `dplyr`, `yaml`, `biomaRt`, `rlang`, `knitr`, `rmarkdown`, `whisker`
- (Optional) RStudio for easier workflow

Install required packages in R:

```r
install.packages(c("devtools", "dplyr", "yaml", "biomaRt", "rlang", "knitr", "rmarkdown", "whisker"))
```

## 1. Clone the Repository

```sh
git clone https://github.com/yourusername/annotables.git
cd annotables
```

## 2. Install Package Dependencies

In R, from the project root:

```r
devtools::install_deps(dependencies = TRUE)
```

## 3. Generate All Data Files

All `.rda` data files in `data/` are generated from the recipes and code in `data-raw/build.Rmd` and `data-raw/recipes/*.yml`.

**To rebuild all data:**

- Open `data-raw/build.Rmd` in RStudio and click "Knit"; or
- In R, run:

```r
rmarkdown::render("data-raw/build.Rmd")
```

This will:
- Download and process gene annotation data from Ensembl using the YAML recipes
- Save all `.rda` files to `data/`
- Auto-generate documentation in `R/`
- Update the Ensembl version

## 4. Rebuild Documentation

The main README and package documentation are generated from `README.Rmd`:

```r
rmarkdown::render("README.Rmd")
```

## 5. Build and Install the Package

```r
devtools::document()
devtools::build()
devtools::install()
```

## 6. Test Your Build

```r
library(annotables)
ls("package:annotables")
```

## 7. Adding a New Species (Creating a YAML Recipe)

To add a new species, create a YAML recipe file in `data-raw/recipes/` with the following structure:

```yaml
name: Common Name
species: Scientific name
host: https://useast.ensembl.org
biomart: ENSEMBL_MART_ENSEMBL
dataset: <ensembl_dataset_name>
attributes:
  ensgene: ensembl_gene_id
  entrez: entrezgene_id
  symbol: external_gene_name
  chr: chromosome_name
  start: start_position
  end: end_position
  strand: strand
  biotype: gene_biotype
  description: description
```

- **name**: Common name of the species (e.g., Pig)
- **species**: Scientific name (e.g., Sus scrofa)
- **host**: Ensembl host URL (usually `https://useast.ensembl.org`)
- **biomart**: Always `ENSEMBL_MART_ENSEMBL`
- **dataset**: The Ensembl dataset name (e.g., `sscrofa_gene_ensembl`). Find this using `listDatasets()` in R:
  ```r
  library(biomaRt)
  mart <- useMart("ENSEMBL_MART_ENSEMBL", host = "https://useast.ensembl.org")
  listDatasets(mart)
  ```
- **attributes**: Mapping of output column names to Ensembl attribute names.

Save the file as `<species>.yml` (e.g., `sscrofa.yml`) in `data-raw/recipes/`.

After adding the YAML, rerun the build steps above to generate the new data and documentation.

## Notes and Troubleshooting

- If you add new species or data, create a new YAML recipe in `data-raw/recipes/` and update `build.Rmd` if needed.
- All data generation is controlled by the YAML recipes and the code in `build.Rmd`.
- If you encounter errors, check for missing R packages or internet connectivity (for Ensembl downloads).
- Ensure all scripts and data are under version control.

## Known Inconsistencies to Check

- Ensure all `.rda` files in `data/` are generated by the current `build.Rmd` and recipes.
- Check that all datasets are documented in `R/` and listed in `NAMESPACE`.
- Verify that the Ensembl version in the data matches the documentation.
- Avoid hardcoded paths or OS-specific code in scripts.
- Update dependencies in `DESCRIPTION` if you add new packages.

---

This process ensures the repository is fully reproducible and up to date. For any issues, consult the code in `data-raw/build.Rmd` and the YAML recipes.
